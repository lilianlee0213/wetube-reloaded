extends base.pug

block content
    div.watch__container
        div#videoContainer.video-container(data-id=video._id)
            div.video
                video(src="/" + video.fileUrl, autoplay)#video
            div#videoControls.video__controls
                div.video__controls__timeline
                    input(type="range", step='1', value=0, min='0')#timeline
                div.video__controls__buttons    
                    div
                        span#play
                            i.fa-solid.fa-pause
                        span#forward 
                            i.fas.fa-step-forward
                        span#mute
                            i.fas.fa-volume-up
                        div
                            input(type='range', step="0.1", value=0.5, min='0', max='1')#volume 
                        div.video__controls__time
                            span#currentTime 00:00
                            span  / 
                            span#totalTime 00:00
                    div
                        span#fullScreen 
                            i.fas.fa-expand
        div.info-container
            h1.video-title=video.title
            div.video-creator
                if !video.creator.avatarUrl
                    a(href=`/users/${video.creator._id}`).avatar.no-image
                        span=video.creator.lastName.substring(0,1) 
                else
                    a(href=`/users/${video.creator._id}`)   
                        img(src=`${video.creator.avatarUrl}`,crossOrigin).avatar
                div.video-creator__info   
                    a(href=`/users/${video.creator._id}`)=video.creator.username
                    small 123K subscribers
                button.subscribe-btn Subscribe
            div.video-buttons 
                button#likeBtn
                    i.fa-regular.fa-thumbs-up
                    span |
                    span=video.meta.rating
                button 
                    i.fa-solid.fa-arrow-up-from-bracket
                    span Share
                button 
                    i.fa-solid.fa-download
                    span Download 
                button
                    i.fa-solid.fa-bookmark
                    span Save  
                button
                    i.fa-solid.fa-ellipsis
            div.video-meta 
                strong.video-meta__views #{video.meta.views} views
                small.video-meta__createdAt=moment(video.createdAt).fromNow()
                small.video-meta__hashtags=video.hashtags
                p=video.description

        div.comments-container
            div.comment-form
                if loggedIn
                    if !loggedInUser.avatarUrl
                        a(href=`/users/${loggedInUser._id}`).avatar.no-image
                            span=loggedInUser.lastName.substring(0,1) 
                    else
                        a(href=`/users/${loggedInUser._id}`)   
                            img(src=`${loggedInUser.avatarUrl}`,crossOrigin).avatar
                    form#commentForm.comment-form__form
                        textarea(placeholder="Add a comment...")#textarea
                        div.comment-form__btns
                            button.cancel Cancel
                            button.comment Comment
                else
                    div.avatar.default-user
                        i.fa-solid.fa-user
                    a(href="../login").comment-form__form.to-login
                        textarea(placeholder="Add a comment...")
            div.comment-view
                each comment in video.comments.reverse()
                    div.comment-view__list
                        if !comment.avatarUrl
                            a(href=`/users/${comment._id}`).avatar.no-image
                                    span=comment.lastName.substring(0,1) 
                        else
                            a(href=`/users/${comment._id}`)   
                                img(src=`${comment.avatarUrl}`,crossOrigin).avatar
                        div.comment-view__content
                            span=comment.username 
                            span=moment(video.createdAt).fromNow()
                            p=comment.text
                            span 
                                i.fa-regular.fa-thumbs-up
                            span=video.meta.rating

        div.moreVideos-container
            each video in videos
                div.moreVideo
                    div.video-thumbnail(style=`background-image:url(${ "/" + video.thumbUrl});background-size:cover; background-position:center;`)
                    div.video-desc
                        a(href=`/videos/${video.id}`).video-title=video.title.slice(0,40) + '...'
                        a(href=`/users/${video.creator._id}`).video-creator=video.creator.username
                        div.video-meta 
                            span #{video.meta.views} views
                            span=moment(video.createdAt).fromNow()
            else 
                li sorry nothing found
        //- div
        //-     p=video.description
        //-     small=video.createdAt
        //- div 
        //-     small Uploaded by 
        //-         a(href=`/users/${video.creator._id}`)=video.creator.username
        if loggedInUser
            if String(video.creator._id) === String(loggedInUser._id)
                a(href=`${video.id}/edit`) Edit Video &rarr; 
                br
                a(href=`${video.id}/delete`) Delete Video &rarr; 
block scripts
    script(src="/static/js/videoPlayer.js")
    script(src="/static/js/commentSection.js")
        